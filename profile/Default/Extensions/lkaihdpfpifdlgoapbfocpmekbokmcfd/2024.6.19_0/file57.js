'use strict';{let k,D=(a,b)=>_O(["scrtEdtr",a],k[a]=b),h=a=>$(a).closest("scriptEditor"),m=a=>_Me(h(a).find("[name=scriptId]")[0]),P=a=>h(a).find("[srcFile] [type=text]").val().trim(),w=a=>h(a).find("editPane > toolbar"),l=a=>{a=$("editPane",h(a));return $(".CodeMirror",a)[0]||$("textarea",a)[0]},x=a=>{a=l(a);return[a.offsetWidth,a.offsetHeight]},p=a=>a&&!a.isClean()&&!a.isReadOnly(),n=a=>b=>{!a||p(l(a).cmObj)?_Dg("","Unsaved changes in the current script will be lost. <hr b=3> Discard changes?")(b):
b(!0)},y=function(a,b){if(!b)return $("codeField > textarea",h(a)).val();a=l(a);return a.cmObj?a.cmObj.getValue():a.value},t=function(a){a=l(a);"hidden"!=$(a).css("visibility")&&$(a).is(":visible")&&(a.cmObj?a.cmObj.focus():(a.selectionStart==a.value.length&&a.selectionEnd==a.value.length&&a.setSelectionRange(0,0),a.focus()))},u=function(a,b,c){a=l(a);a.cmObj?a.cmObj.setSize(b,c):$(a).css({width:b,height:c})};var _Fr=_qf(function*(a,b){let c=yield _0g({scriptId:a},!0);$(c).attr("helpCtx","actions/actList/runScript");
let d=_6k(b?"":"Script Editor",c,"",!1),e=(Math.random()+"").substr(2);$(d).attr("UID",e).on("close",()=>$(window).off("."+e).delEvtCapture("."+e));$(window).captureTgtEvt("close."+e,`[UID=${e}]`,(f,g)=>{!g&&p(l(c).cmObj)&&(f.stopPropagation(),n()(r=>{r&&$(d).triggerEvt({close:!0})}))}).on("beforeunload."+e,f=>{if(p(l(c).cmObj))return"Unsaved changes in the current script will be lost."});$("> header ctrls",d).prepend('\n <b popout title="Pop out">&#60030;</b>\n <b maximize title="Maximize">&#59787;</b>\n <b restore title="Restore">&#59788;</b>\n ').on("click",
"[popout]",_ug(function*(){if(yield n(c))window.open("#script="+m(c),"_blank"),$(d).triggerEvt({close:!0})})).on("click","[maximize]",()=>{let f=x(c),g=d.offsetWidth-f[0],r=d.offsetHeight-f[1];d.prevCoors=[d.offsetLeft,d.offsetTop,...f];$(d).css({left:0,top:0}).addClass("maximized");$(window).on("resize."+e,()=>u(c,window.innerWidth-g,window.innerHeight-r)).trigger("resize")}).on("click","[restore]",()=>{let f=d.prevCoors;u(c,f[2],f[3]);$(d).css({left:f[0],top:f[1]}).removeClass("maximized");$(window).off("resize."+
e)});b&&(yield _Fy(150),$("> header [maximize]",d)[0].click())}),_Zs=_qf(function*(a,b){let c=yield _0g({scriptId:a},!0);$(c).attr("helpCtx","actions/actList/runScript");let d=_Ef(b?"":"Script Editor",c,"",!1,!0,[732,520]).Show(!1),e=(Math.random()+"").substr(2);$(d).attr("UID",e).on("close",()=>$(window).off("."+e).delEvtCapture("."+e));$(window).captureTgtEvt("close."+e,`[UID=${e}]`,(f,g)=>{!g&&p(l(c).cmObj)&&(f.stopPropagation(),n()(r=>{r&&$(d).triggerEvt({close:!0})}))}).on("beforeunload."+e,
f=>{if(p(l(c).cmObj))return"Unsaved changes in the current script will be lost."});$("diagFrm > header ctrls",d).prepend('\n <b popout title="Pop out"></b>\n <b maximize title="Maximize"></b>\n <b restore title="Restore"></b>\n ').on("click","[popout]",_ug(function*(){if(yield n(c))window.open("#script="+m(c),"_blank"),_H(d)})).on("click","[maximize], [restore]",()=>{$(d).toggleClass("maximized")});b&&(yield _Fy(150),$("diagFrm > header [maximize]",d)[0].click())}),_0g=_qf(function*(a,b=!1){let {scriptId:c,
bkgrnd:d,async:e}=a;k={theme:"default ACtrl-soft",lnWrap:!1,lint:!0}.add(yield _Mt("scrtEdtr"));c||(yield _ha("script"),c=yield f=>E(f));a=_Np(c,"script");a.value||(a.value={});z(c,a.value);a=_Ww(_ga)`\n <scriptEditor hideEditPane ${b?"rich":""} class="${b?k.theme:""}">\n <header>\n <div scriptSel>\n <tag>Script:</tag>\n <btnFld grow name=scriptId value="${c}">\n <input type=text field grow value="${_tw(a.name||"")}" placeholder="(unnamed script)" ${a.value.isCustom?"":"readonly"}><b button></b>\n </btnFld> <h h=name></h>\n </div>\n <div actionOpts>\n <tag>${_Gy("bkgrnd",
d)}Run in background</tag> <h h=bkgr></h> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\n <tag>${_Gy("async",e)}Run asynchronously</tag> <h h=asyn></h>\n </div>\n </header>\n ${F(a.value)}\n <footer DataModule>\n <div tabSel>\n <sSel grow><select style="visibility: hidden"></select><select tabs unset><option value=_>Choose a tab to test run the script...</select></sSel>\n <button testRun>Run</button> <h h=run></h> <button richEdit title="Open the script in the script editor">Script Editor</button>\n </div>\n </footer>\n </scriptEditor>\n `;
b||(yield _Fy(0));Q(a);return a[0]});let Q=function(a){a.on("mousedown change","select:not([tabs])",function(b){$(this).is(":focus")&&(t(this),b.preventDefault())}).on("mousedown change","[tabs]",function(b){300<Date.now()-(this.lastUpdate||0)&&($(this).is(":focus")?t(this):_Ge({url:["http://*/*","https://*/*","file:///*"]})(c=>{let d=this.value;$(":not(:first-child)",this).remove();c.unshift({id:0,title:"<< Background >>"});c.forEach(e=>this.options.add(new Option(e.title,e.id,!1,e.id==d)));this.lastUpdate=
Date.now();_Ba._Ya(_9p,[_Ci,_Ci|_Lw])}),b.preventDefault());$(this).attr("unset",Number.isInteger(+this.value)?null:"")}).on("mousedown","[scriptSel] btnFld [button]",function(){let b=this.closest("[name]");R(b,a.is("[rich]"))(c=>{_aw(c,b,"b)t)r<l< ,HR,VR","borderAndShadowSimple noTail");$("item[selected]",c).each(function(){this.scrollIntoViewIfNeeded(!0)})})}).on("mousedown","[scriptSel] btnFld input[readonly]",function(){$(this).siblings("[button]").triggerEvt("mousedown",!0)}).on("input","[name=scriptId]",
_F(200,function(){_mt(function*(){let b=$("[type=text]",this)[0],c=b.value.trim(),d=_Me(this),[e,f]=yield _yj(d,c);f&&(b.value=f);if(!e)return!1;_5g([d,"name"],c,0,()=>{a.triggerEvt("input",!0);a.is("[rich]")&&_Ch.updActLbl(d)})},[],this);return!1},()=>!1)).on("input","[srcFile] [type=text]",_F(600,function(b){G(this,!0)})).on("input","codeField > textarea",_1d(400,function(b){H(this)()})).on("keydown","codeField > textarea",function(b){9==b.keyCode?(this.setRangeText("\t",this.selectionStart,this.selectionEnd,
"end"),b.preventDefault(),$(this).triggerEvt("input",!0)):82==b.keyCode&&b.ctrlKey&&(A(this),b.preventDefault())}).on("change","[srcFile] [type=checkbox]",function(b){$(this).parent().attr("checked",this.checked?"":null);G(this)}).on("click","[testRun]",function(){A(this)}).on("click","[richEdit]",function(){_Zs(m(this))()}).on("click","tag",function(b){$(b.target).is("input")||$("input",this).click()}).on("mousedown",function(b){b.target.closest(".CodeMirror, textarea")||$(b.target).is("[type=text], select")||
(b.preventDefault(),t(this))}).on("focusGained",function(){t(this)})},A=_ug(function*(a){let b=h(a).find("[tabs]"),c=+b.val();Number.isInteger(c)?(0!=c&&(yield d=>_Ba._wt(d),_Ba._Ys([c],_Ba._Md)),_Ba._Mr(m(a),c,[c],y(a,!0)).then(_cy,_cy)):(b.addClass("highlight"),yield _Fy(350),b.removeClass("highlight"))}),z=function(a,b){_Tp(a)&&Object.defineProperty(b,"isCustom",{value:!0});return b},v=function(a){var b=h(a);b=$("[srcFile] [type=checkbox]",b)[0].checked?{srcFile:P(b)}:{srcCode:y(b),mdTime:Date.now()};
return z(m(a),b)},H=_qf(function*(a){var b=v(a);if(b.srcFile){a=y(a);b=yield _Ba._9i(b.srcFile);let c=(_ak(b)||{}).encode,d=yield _Ba._7d(b,_Bt(a,c));if(d)return a=yield _Ba._ky(_yk,+d),_2("Error saving the file. <hr b=2>"+a,{type:"error"}),!1;_ak(b,{srcCode:a,encode:c,ldTime:Date.now()})}else _5g([m(a),"value"],b);return!0}),G=function(a,b){a=h(a);let c=$("> content > editPane",a)[0],d=!b&&c.otherEditPane?c.otherEditPane:I(v(a).del("srcCode"),!1)[0];d.otherEditPane=b?c.otherEditPane:c;b=x(a);c.parentNode.replaceChild(d,
c);u(a,...b);a.attr("hideEditPane",a.find("msg:not(:empty)")[0]?"":null);_5g([m(a),"value"],v(a))},F=function(a){a=_Ww(_ga)`\n <content DataModule>\n <div srcFile ${a.isCustom?"":"greyedout"}>\n <tag ${"srcFile"in a?"checked":""}>${_Gy("","srcFile"in a)}External file:</tag>\n <btnFld popupAround grow>${_jp("",a.srcFile||"","Enter a file path or URL...","Javascript files: *.js, All Files: *.*","grow","locPlhlr")}<b button></b></btnFld> <h h=file></h>\n </div>\n ${I(a)}\n </content>\n `;_nu($("btnFld",
a),"b)t)r<l<","L_desk L_doc L_prof L_app L_win L_drv L_prg86 L_rec L_star L_tmp".split(" "),!1);return a},I=function(a,b=!0){let c=_Ww(_ga)`\n <editPane>\n <msg type=busy>${_Pp("busySign")}</msg>\n <toolbar><btn><i>&nbsp;</i></btn></toolbar>\n <codeField>\n <textarea ${_9u(a.srcFile)&&!_Hy(a.srcFile)||!a.isCustom?"readonly":""} spellcheck=false></textarea>\n </codeField>\n </editPane>\n `;J(a)(_ug(function*(d){let e=$("textarea",c).val(d.srcCode)[0];yield _Fy(0);h(c).is("[rich]")&&(yield f=>S(f),
T(e,b));U(c,d.error)}));return c},U=function(a,b){h(a).attr("hideEditPane",b?"":null).find("editPane > msg").attr("type","error").html(b||"")};const K={esversion:55>_Zo?7:9,asyncWrap:55<=_Zo,undef:!0,unused:!0,browser:!0,devel:!0,debug:!0,evil:!0,withstmt:!0,globals:{ACtl:!1}};let T=_ug(function*(a,b=!0){const c=a.offsetWidth,d=a.offsetHeight;let e=$(a).is("[readonly]"),f=CodeMirror.fromTextArea(a,{readOnly:e,lineNumbers:!0,indentWithTabs:!0,indentUnit:4,smartIndent:!1,matchBrackets:!0,foldGutter:!0,
cursorBlinkRate:e?-1:400,cursorHeight:.9,theme:k.theme,lineWrapping:k.lnWrap,lint:k.lint?K:void 0,gutters:["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{"Ctrl-O":L,"Ctrl-S":M,"Ctrl-R":g=>A(g.getWrapperElement())},showCursorWhenSelecting:!0});a=f.getWrapperElement();a.cmObj=f;f.setSize(c,d);(new ResizeObserver(g=>{g=g[0].contentRect;f.setSize(g.width,g.height)})).observe(a.parentElement);V(a);yield g=>_Oa(g);yield _Fy(100);f.refresh();b&&f.focus();N(a,400)}),
L=_ug(function*(a){a=a.getWrapperElement();if(yield n(a)){let b=v(a);b.srcFile&&_ak(yield _Ba._9i(b.srcFile),void 0);B(a,m(a))}}),V=function(a){let b=a.cmObj;w(a).html(`\n <btn act=reopen title="Reopen (Ctrl+O)"><i>&#59950;</i></btn>\n <btn act=save disabled title="Save (Ctrl+S)"><i>&#xE962;</i></btn>\n <btn act=undo disabled title="Undo (Ctrl+Z)"><i blue>&#xE967;</i></btn>\n <btn act=redo disabled title="Redo (Ctrl+Shift+Z)"><i blue>&#xE968;</i></btn>\n <btn act=foldAll disabled title="Fold all"><i>&#xEA88;</i></btn>\n <btn act=unfoldAll disabled title="Unfold all"><i>&#xEA87;</i></btn>\n <btn act=pretty title="Pretty format"><i>{}</i></btn>\n <btn swch=lint ${k.lint?
"checked":""} title="Syntax check"><i>&#xEA12;</i></btn>\n <btn swch=lnWrap ${k.lnWrap?"checked":""} title="Line wrap"><i>&#xEA76;</i></btn>\n <tag opt=theme>Theme: ${_Mo({"default ACtrl-light":"Light","default ACtrl-soft":"Almond","default ACtrl-dark":"Dark"},k.theme)}</tag>\n `).on("click","[act]",function(){switch($(this).attr("act")){case "reopen":L(b);break;case "save":M(b);break;case "undo":b.undo();break;case "redo":b.redo();break;case "foldAll":b.execCommand("foldAll");C(a);break;case "unfoldAll":b.execCommand("unfoldAll");
C(a);break;case "pretty":b.setValue(W(b.getValue())),N(a,1E3)}}).on("mousedown","[swch]",function(){let c=$(this).attr("swch"),d=null==$(this).attr("checked");$(this).attr("checked",d?"":null);D(c,d);switch(c){case "lint":b.setOption(c,d?K:void 0);break;case "lnWrap":b.setOption("lineWrapping",d)}}).on("change","[opt]",function(c){let d=$(this).attr("opt");switch(d){case "theme":b.setOption("theme",c.target.value),h(this).attr("class",c.target.value),D(d,c.target.value)}});b.on("change",(c,d)=>O(c));
b.on("fold",c=>setTimeout(()=>q(b.getWrapperElement())));b.on("unfold",c=>setTimeout(()=>q(b.getWrapperElement())))},W=function(a){return js_beautify(a,{indent_with_tabs:!0,end_with_newline:!0,wrap_line_length:120})},O=_F(250,a=>{let {undo:b,redo:c}=a.historySize(),d=w(a.getWrapperElement());$("[act=save]",d).attr("disabled",p(a)?null:"");$("[act=undo]",d).attr("disabled",b?null:"");$("[act=redo]",d).attr("disabled",c?null:"");C(a.getWrapperElement())}),q=function(a){let b=w(a),c=a.querySelector(".CodeMirror-foldgutter-folded");
a=a.querySelector(".CodeMirror-foldgutter-open");$("[act=foldAll]",b).attr("disabled",a?null:"");$("[act=unfoldAll]",b).attr("disabled",c?null:"")},C=_1d(700,q),N=function(a,b){setTimeout(()=>q(a),b);setTimeout(()=>q(a),2*b);setTimeout(()=>q(a),3*b)},M=function(a){a.isClean()||(a.save(),H(a.getWrapperElement())(b=>{b&&(a.markClean(),O(a))}))},R=_qf(function*(a,b){let c=_Me(a),d=_qf(function*(e,f){f||(f=_Np(e));let g=yield J(f.value,!0);return`\n <item ${_Tp(e)?"custom":""} value="${e}" ${e==c?"selected":
""}>\n <div><l>${f.name}</l> <br>\n <size>${g&&!g.error?_nk(g.srcCode.length)+"B":""}</size>\n <date>${g&&!g.error?`${g.ldTime?"Loaded":"Modified"} ${_Bs(new Date(g.ldTime||g.mdTime))}`:""}</date>\n </div> <del button title="Delete"></del>\n </item>\n `});return _ga(yield _Ww`\n <namedEntityMenu script DataModule>\n ${[..._Ba._tt.script].map(e=>d(...e))}\n ${[..._ea("script",!0)].map(e=>d(e))}\n ${$("[type=text]",a).val().trim()||b?"<newEntity>New script...</newEntity>":""}\n </namedEntityMenu>\n `).on("click",
"del",function(e){e.stopImmediatePropagation()}).on("dblclick","del",function(){let e=_Me(this.closest("item"));_sk(e,()=>$(this).closest("item").remove())}).on("click","item:not([selected])",function(){n(a)(e=>{e&&(B(a,_Me(this)),_Ts())})}).on("click","newEntity",function(){n(a)(e=>{e&&E(f=>{B(a,f);_Ts()})})})}),B=function(a,b){let c=_Np(b,"script");z(b,c.value);a=h(a);a.find("[name=scriptId]").val(b).triggerEvt("change",!0).find("[type=text]").val(c.name).prop("readOnly",!c.value.isCustom);let d=
x(a);a.attr("hideEditPane","").find("> content").replaceWith(F(c.value));u(a,...d);_yg(location)&&(location.hash="script="+b)},E=function(a){_vi("script",{srcCode:"//example script\nalert('Hello, world!') ;\n",mdTime:Date.now()})(b=>{_8k(b)();a(b)})},J=_qf(function*(a,b){if(!("srcFile"in a))return a;if(!a.srcFile)return{error:"Local files can be viewed and edited here. <br> URLs can be viewed but not edited."};a=yield _Ba._9i(a.srcFile);if(b)return _ak(a);b=yield _Ba._Nw(a);null!=b.error&&(b.error=
_Hy(a)||!_9u(a)?yield _Ba._ky(_yk,b.error):_jg(b.error));return b}),S=function(a){let b=["https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/codemirror.min.css","https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/fold/foldgutter.min.css","https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/lint/lint.min.css"],c="https://cdnjs.cloudflare.com/ajax/libs/jshint/2.10.2/jshint.min.js https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.10.2/beautify.min.js https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/mode/javascript/javascript.min.js https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/edit/matchbrackets.min.js https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/fold/foldcode.min.js https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/fold/foldgutter.min.js https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/fold/brace-fold.min.js https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/fold/indent-fold.min.js https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/fold/comment-fold.min.js https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/addon/lint/lint.min.js /res/javascript-lint.min.js".split(" ");
_0u(_jy("/file52.css"),_th("https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.4/codemirror.min.js"),_Fy(150))(()=>_0u(b.map(_jy),c.map(_th),_Fy(100)))(a)}};
