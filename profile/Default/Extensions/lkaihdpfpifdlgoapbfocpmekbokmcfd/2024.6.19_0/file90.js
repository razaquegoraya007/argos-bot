'use strict';function _it(a,e,f){var g="";for(let [n,p]of _Ba._Vw){var b=p.bounds,c=p.workArea,d=n,k=b.width/6,m=b.height/6,h=b.top/6,l=b.left/6,r=(c.top-b.top)/6;b=(c.left-b.left)/6;var t=c.width/6;c=c.height/6;if(a.unit&&"tile"!=a.unit)var q="";else q=_kf(e,n),q=`<grid>${`<row>${"<tile></tile>".repeat(q.cols)}</row>`.repeat(q.rows)}</grid>`;g+=`\n <screen monId="${d}" style="width: ${k}px ; height: ${m}px; top: ${h}px; left:${l}px">\n <workarea style="top: ${r}px; left: ${b}px; width: ${t}px; height: ${c}px">\n ${q}\n <name>${p.name}</name>\n </workarea>\n </screen>\n `}a=
"";for(let [n,p]of f)a+=`<win class="${p}" style="left: ${n.x/6}px ; top: ${n.y/6}px ; width: ${n.w/6}px ; height: ${n.h/6}px"></win>`;f=_Ba._Vw.desktop;e=f.w/6+2;d=f.h/6+2;return`<screenLayout style="min-width: ${e}px; min-height: ${d}px"><viewport style="width: ${e}px ; height: ${d}px">\n <origin style="top: ${-f.y/6-1}px ; left: ${-f.x/6-1}px">\n ${g}\n ${a}\n </origin>\n </viewport></screenLayout>`}
function _is(a,e,f){_Ba._wt(()=>{let g=_tr(a),b=_Np(g.gridLayout,"gridLayout").value;if(g.unit){var c=_Ba._pj[e]||_Ba._pj[_Ba._Ui],d=_I(_8e(c));let k=_Ba._7u(d,b,g);d=[[d,"win1"],[k,"win2"]]}else{g.baseMonitor||(g.baseMonitor=Object.keys(_Ba._Vw)[0]);let [k,m]=_Ba._P(g);d=Array(m).fill(0,0).map(()=>[k.next().value,"tile"])}f(_it(g,b,d),(c||{}).id)})}
function _Dr(a,e,f){_is(a,e,(g,b)=>{f(`\n <preview>${g}</preview>\n ${b?`\n <leyend><i class=win1></i>Before <i class=win2></i>After <h h=win></h></leyend>\n ${_Mo([..._Ba._pj].map(([c,d])=>[c,d.activeTab.title]),b)}\n `:"\n <leyend><i class=tile></i>Tiling area <h h=til></h></leyend>\n "}\n `,b)})}
function _Tr(a,e){_Dr(a,_Ba._Ui,(f,g)=>{let b=$(`<winActionPreview dontCloseOnFocusLost DataModule helpCtx="../winActPrev">${f}</winActionPreview>`)[0],c=_F(100,()=>{_is(a,$("select",b).val(),h=>$("preview",b).html(h))}),d=_1d(200,()=>{_Dr(a,$("select",b).val(),h=>b.innerHTML=h)});$([a,b]).on("input change redefine",c);const k=["onCreated","onRemoved","onActivated","onUpdated","onMoved"];if(g){_4d(_Sf.tabs,k,d);let h={};var m=setInterval(()=>{_Ur(+$("select",b).val(),!1,l=>{if(_pd())return d();l.keep("left",
"top","width","height");h.includes(l)||(c(),h=l)})},400)}$(b).on("close",function(){$(a).removeClass("popup").off("",c);_Qr(_Sf.tabs,k,d);clearInterval(m);$(this).remove()});e(b)})}
function _9g(a,e,f,g,b,c){let d=_I(_8e(_Ba._pj[c]));c=b.baseMonitor||_Ba._ud(d);let k=_Ba._2u(_Np(b.gridLayout,"gridLayout").value,c),m=e.in("x","w")?"w":"h";e=(h,l)=>Math.round(h*Math.pow(d[m]/100,l));b=(h,l)=>Math.round(h*Math.pow(k[m],l));switch(g){case "px":return"%"==f?e(a,1):b(a,1);case "tile":return b("%"==f?e(a,1):a,-1);case "%":return e("tile"==f?b(a,1):a,-1)}}
function _L(a){a.previewPane?_6h(a):_Tr(a,e=>{a.previewPane=_aw(e,$(a).closest("[popupCntr]")[0]||a,"lbrt ,BR","tailOnly noTail under");$(a.previewPane).removeAttr("popupCntr")})}function _6h(a){$(a.previewPane).triggerEvt("close");delete a.previewPane}function _aj(){return'<preview title="See a live preview of the action"><w1>Preview</w1><w2>Hide</w2><br>result</preview>'};
