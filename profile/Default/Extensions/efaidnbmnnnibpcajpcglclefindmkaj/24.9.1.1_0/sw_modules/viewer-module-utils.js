/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
import{common as e}from"./common.js";import{getVersionConfig as t}from"./api-util.js";import{util as n}from"./util.js";import{SETTINGS as o}from"./settings.js";import{dcLocalStorage as i}from"../common/local-storage.js";import{floodgate as c}from"./floodgate.js";import{loggingApi as s}from"../common/loggingApi.js";import{analytics as a}from"../common/analytics.js";let r;r||(r=new function(){this.updateVariables=async function(t){try{let r=0!=t&&1!=t&&-1!=t,l=!(!r||t===o.READER_VER||t===o.ERP_READER_VER);i.setItem("locale",n.getFrictionlessLocale(chrome.i18n.getMessage("@@ui_locale"))),i.setItem("cdnUrl",e.deriveCDNURL(e.getEnv())),i.setItem("signInUrl",e.getSignInUrl()),i.setItem("isDeskTop",r),i.setItem("env",e.getEnv()),i.setItem("viewerImsClientId",e.getViewerIMSClientId()),i.setItem("imsContextId",e.getImsContextId()),i.setItem("viewerImsClientIdSocial",e.getViewerIMSClientIdSocial()),i.setItem("imsURL",e.getIMSurl()),i.setItem("imsLibUrl",e.getImsLibUrl()),i.setItem("dcApiUri",e.getDcApiUri()),i.setItem("isAcrobat",l),i.getItem("theme")||i.setItem("theme","auto");const d={"dc-cv-enable-download-dialog":"edd","dc-cv-rapid-rendition-view":"rrv","dc-cv-lin-rrv":"lrrv","dc-cv-save-location-on-options":"isSaveLocationPrefEnabled","dc-cv-enable-splunk-logging":"splunkLoggingEnable","dc-cv-enable-embed-viewer":"ev","dc-cv-ext-menu-dark-mode":"enableExtMenuDarkMode","dc-cv-alloy-on":"ao","dc-register-access-token-expired":"rate","dc-cv-alloy-on-ext-menu":"aoem","dc-cv-image-print":"ip","dc-cv-document-properties":"sdp","dc-cv-show-digital-signature":"sds","dc-cv-enable-cdn-versioning":"enableCDNVersioning","dc-cv-gen-ai":"genAI","dc-cv-premium-icon":"pi","dc-cv-mega-verbs":"mv","dc-cv-keyboard-shortcut":"ks","dc-cv-inline-rs":"rs","dc-cv-enable-CSRF":"enableCSRF","dc-cv-night-mode":"supportNightMode","dc-cv-thumbnail-plg-test":"tpt","dc-cv-local-file-access-tp":"lft","dc-cv-upsell-full-screen-chrome":"fsu","dc-cv-doc-cloud-share":"dcs","dc-cv-enable-genai-limits-api":"egal","dc-cv-other-tab-signout":"ots","dc-cv-cdn-sign-in":"csi","dc-cv-settings-window":"openSettingsInWindow","dc-cv-localised-gif":"showLocalisedGif","dc-cv-enable-guest-genai":"gga","dc-cv-reset-counter":"rc","dc-cv-decrease-cooldown":"dc","dc-cv-enable-pnb":"pnb","dc-cv-enable-akamai":"akamai","dc-cv-subscription-v2-api":"subv2","dc-cv-s3-download":"s3d","dc-cv-download-banner":"downloadBanner","dc-cv-ims-profile-switcher":"ips"};navigator.onLine&&(d["dc-cv-offline-support-disable"]="offlineSupportDisable");const m=await Promise.all(Object.entries(d).map((([e,t])=>this.checkFeatureEnable({flagName:e,storageKey:t}).then((e=>[t,e]))))),v=Object.fromEntries(m),g=v.isSaveLocationPrefEnabled,p=v.splunkLoggingEnable,u=v.supportNightMode;if(v.downloadBanner&&!i.getItem("downloadBannerFlag")&&(i.setItem("downloadBannerFlag",!0),a.event(a.e.DOWNLOAD_BANNER_ENABLED)),!g&&i.getItem("saveLocation")?i.removeItem("saveLocation"):g&&!i.getItem("saveLocation")&&i.setItem("saveLocation","ask"),!u&&i.getItem("isDarkPageThemeEnabled")&&i.removeItem("isDarkPageThemeEnabled"),s.registerLogInterval(p),p){let e=c.getFeatureMeta("dc-cv-enable-splunk-logging")||{};e=JSON.parse(e),i.setItem("allowedLogIndex",e.index)}i.removeItem("allownft")}catch(e){console.error("Error checking feature flags:",e)}},this.checkFeatureEnable=async function(e){const{flagName:t,storageKey:n}=e,o=await c.hasFlag(t);return n&&i.setItem(n,!!o),o},this.fetchAndUpdateVersionConfig=async function(){if(i.getItem("enableCDNVersioning"))try{const e=await t();if(e){const t={...n("prod",e.prod),...n("non_prod",e.non_prod)};i.setItem("version-config",t)}}catch(e){console.log(new Error(`Version Config failure: ${e}`))}function e(e,t){for(var n in e.extension)if(e.extension[n].id===t)return{iv:e.extension[n].internal_version,ev:e.extension[n].external_version}}function n(t,n){if(!n)return;let o={};const i=e(n,"all_extensions"),c=e(n,chrome.runtime.id);return o[`ev_${t}`]="inherit"!==c?.ev?c?.ev:i?.ev,o[`iv_${t}`]="inherit"!==c?.iv?c?.iv:i?.iv,o}}});export const viewerModuleUtils=r;